<h2>Import from DICOM</h2>
<form [@preventInitialChildAnimations]>

    <dicom-upload
        class="step-block"
        [open]="opened == 'dicom'"
        [disabled]="false"
        (validityChange)="dicomValid=$event; updateState();"
        (inMemoryExtracted)="onFilesExtracted($event)" 
        (archiveUploaded)="onArchiveUploaded($event)"
        (headerClick)="toggle('dicom')">
    </dicom-upload>

    <select-series
        class="step-block"
        [open]="opened == 'series'"
        [disabled]="!seriesEnabled"
        (validityChange)="seriesValid=$event; updateState();"
        [patients]="importJob?.patients" 
        [dataFiles]="extracted" 
        (patientsChange)="onPatientsChange($event)"
        (headerClick)="toggle('series')">
    </select-series>

    <clinical-context
        class="step-block"
        [open]="opened == 'context'"
        [disabled]="!contextEnabled"
        (validityChange)="contextValid=$event; updateState();"
        [patient]="patient" 
        (contextChange)="onContextChange($event)" 
        [examinationComment]="comment"
        (headerClick)="toggle('context')">
    </clinical-context>

    <div class="step-block" [class.active]="true">
        <div class="header command-zone" [class.disabled]="!isValid()" (click)="isValid() ? toggle('final') : null">4. Import the data</div>
        <div *ngIf="isValid() && opened == 'final'" class="step last">
            <button (click)="startImportJob($event)">Import now</button>
        </div>
    </div>

</form>