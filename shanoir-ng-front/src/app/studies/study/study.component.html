<div class="content-component detail max-content">
	<div class="layout left">
		<form [formGroup]="studyForm" novalidate>
			<span class="right-col" [ngSwitch]="mode">
				<ng-template [ngSwitchCase]="'view'">
					<div class="header command-zone" i18n="View study|Title@@studyDetailViewTitle">Details on study</div>
				</ng-template>
				<ng-template [ngSwitchCase]="'edit'">
					<div class="header command-zone" i18n="Edit study|Title@@studyDetailEditTitle">Edit study</div>
				</ng-template>
				<ng-template [ngSwitchCase]="'create'">
					<div class="header command-zone" i18n="Create study|Title@@studyDetailCreateTitle">Create study</div>
				</ng-template>
			</span>
			<fieldset>
				<ol>
					<li>
						<label i18n="Study detail|Name label@@studyDetailName" class="required-label">Name</label>
						<span class="right-col" [ngSwitch]="mode">
							<ng-template [ngSwitchCase]="'view'">
								{{study.name}}
							</ng-template>
							<ng-template ngSwitchDefault>
								<input type="text" id="name" required minlength="2" maxlength="200" formControlName="name" [(ngModel)]="study.name" />
								<label *ngIf="formErrors.name.includes('required')" class="form-validation-alert" i18n="Edit study|Name required error@@studyDetailNameRequiredError">Name is required!</label>
								<label *ngIf="formErrors.name.includes('length')" class="form-validation-alert" i18n="Edit study|Name length error@@studyDetailNameLengthError">Name length must be between 2 and 200!</label>
								<label *ngIf="isNameUnique==false" class="form-validation-alert" i18n="Edit study|Name unique error@@studyDetailNameUniqueError">Name should be unique!</label>
							</ng-template>
						</span>
					</li>
					<li>
						<label i18n="Study detail|Start date label@@studyDetailStartDate">Start date</label>
						<span class="right-col" [ngSwitch]="mode">
							<ng-template [ngSwitchCase]="'view'">
								{{study.startDate | date: 'dd/MM/yyyy'}}
							</ng-template>
							<ng-template ngSwitchDefault>
								<my-date-picker id="startDate" [options]="myDatePickerOptions" formControlName="startDate" [(ngModel)]="startDate" (dateChanged)="onStartDateChanged($event)"
								 (inputFieldChanged)="onStartDateFieldChanged($event)" [selDate]="selectedStartDateNormal">
								</my-date-picker>
								<label *ngIf="isStartDateValid==false" class="form-validation-alert" i18n="Study detail|Date valid error@@dateValidError">Date should be valid! Date format: dd/mm/yyyy</label>
							</ng-template>
						</span>
					</li>
					<li>
						<label i18n="Study detail|End date label@@studyDetailEndDate">End date</label>
						<span class="right-col" [ngSwitch]="mode">
							<ng-template [ngSwitchCase]="'view'">
								{{study.endDate | date: 'dd/MM/yyyy'}}
							</ng-template>
							<ng-template ngSwitchDefault>
								<my-date-picker id="endDate" [options]="myDatePickerOptions" formControlName="endDate" [(ngModel)]="endDate" (dateChanged)="onEndDateChanged($event)"
								 (inputFieldChanged)="onEndDateFieldChanged($event)" [selDate]="selectedEndDateNormal">
								</my-date-picker>
								<label *ngIf="isEndDateValid==false" class="form-validation-alert" i18n="Study detail|Date valid error@@dateValidError">Date should be valid! Date format: dd/mm/yyyy</label>
							</ng-template>
						</span>
					</li>
					<li>
						<label i18n="Study detail|Status label@@studyDetailStatus" class="required-label">Status</label>
						<span class="right-col" [ngSwitch]="mode">
							<ng-template [ngSwitchCase]="'view'">
								{{studyStatusEnumValue}}
							</ng-template>
							<ng-template ngSwitchDefault>
								<select id="studyStatus" required formControlName="studyStatus" [(ngModel)]="study.studyStatus">
									<option *ngFor="let studyStatus of studyStatuses" [value]="studyStatus.key">{{studyStatus.value}}</option>
								</select>
								<label *ngIf="formErrors.studyStatus.includes('required')" class="form-validation-alert" i18n="Study detail|Status required error@@studyDetailStatusRequiredError">Status is required!</label>
							</ng-template>
						</span>
					</li>
					<li>
						<label i18n="Study detail|With examination label@@studyDetailWithExamination">Is with examination</label>
						<span class="right-col" [ngSwitch]="mode">
							<span class="right-col">
								<input type="radio" formControlName="withExamination" [(ngModel)]="study.withExamination" [value]="true" i18n="Study detail|Yes label@@yesLabel"
								 [checked]="study.withExamination" />Yes
								<input type="radio" formControlName="withExamination" [(ngModel)]="study.withExamination" [value]="false" i18n="Study detail|No label@@noLabel"
								 [checked]="!study.withExamination" />No
							</span>
						</span>
					</li>
					<li>
						<label i18n="Study detail|Clinical label@@studyDetailClinical" class="required-label">Is clinical</label>
						<span class="right-col" [ngSwitch]="mode">
							<span class="right-col">
								<input type="radio" formControlName="clinical" [(ngModel)]="study.clinical" [value]="true" i18n="Study detail|Yes label@@yesLabel"
								 [checked]="study.clinical" />Yes
								<input type="radio" formControlName="clinical" [(ngModel)]="study.clinical" [value]="false" i18n="Study detail|No label@@noLabel"
								 [checked]="!study.clinical" />No
							</span>
						</span>
					</li>
					<li>
						<label i18n="Study detail|Visible by default label@@studyDetailVisibleByDefault">Visible by default</label>
						<span class="right-col" [ngSwitch]="mode">
							<span class="right-col">
								<input type="radio" formControlName="visibleByDefault" [(ngModel)]="study.visibleByDefault" [value]="true" i18n="Study detail|Yes label@@yesLabel"
								 [checked]="study.visibleByDefault" />Yes
								<input type="radio" formControlName="visibleByDefault" [(ngModel)]="study.visibleByDefault" [value]="false" i18n="Study detail|No label@@noLabel"
								 [checked]="!study.visibleByDefault" />No
							</span>
						</span>
					</li>
					<li>
						<label i18n="Study detail|Data downloadable by default label@@studyDetailDownloadableByDefault">Data downloadable by default</label>
						<span class="right-col" [ngSwitch]="mode">
							<span class="right-col">
								<input type="radio" formControlName="downloadableByDefault" [(ngModel)]="study.downloadableByDefault" [value]="true" i18n="Study detail|Yes label@@yesLabel"
								 [checked]="study.downloadableByDefault" />Yes
								<input type="radio" formControlName="downloadableByDefault" [(ngModel)]="study.downloadableByDefault" [value]="false" i18n="Study detail|No label@@noLabel"
								 [checked]="!study.downloadableByDefault" />No
							</span>
						</span>
					</li>
					<li>
						<label i18n="Study detail|Mono or multicenter label@@studyDetailMonoCenter" class="required-label">Mono or multicenter</label>
						<span class="right-col" [ngSwitch]="mode">
							<span class="right-col">
								<input type="radio" formControlName="monoCenter" [(ngModel)]="study.monoCenter" [value]="true" i18n="Study detail|Yes label@@noLabel"
								 [checked]="study.monoCenter" />Mono-center
								<input type="radio" formControlName="monoCenter" [(ngModel)]="study.monoCenter" [value]="false" i18n="Study detail|No label@@yesLabel"
								 [checked]="!study.monoCenter" />Multi-centers
							</span>
						</span>
					</li>
					<li *ngIf="mode != 'view'">
						<label i18n="Study detail|List of centers and principal investigator label@@studyDetailCentersAndPI">List of centers and principal investigator</label>
						<span class="right-col">
							<select [(ngModel)]="selectedCenter" [ngModelOptions]="{standalone: true}">
								<option *ngFor="let center of centers" [ngValue]="center" [disabled]="isCenterAlreadyLinked(center.id)">{{center.name}}</option>
							</select>
							<img [hidden]="!enableAddIcon()" [src]="addIconPath" class="icon icon-clickable" (click)="addCenterToStudy()"/>
							<img [hidden]="enableAddIcon()" [src]="addDisabledIconPath" class="icon"/>
						</span>
					</li>
					<li *ngIf="mode != 'view'">
						<label i18n="Study detail|List of centers and principal investigator label@@studyDetailCentersAndPI" class="required-label">Current centers and Investigators</label>
						<span class="right-col study-center-list">
							<div *ngFor="let studyCenter of study.studyCenterList">
								<a [routerLink]="['/center']" [queryParams]="{mode: 'view', id: studyCenter.center.id}">
									{{studyCenter.center.name}}
								</a>
								<img [src]="deleteIconPath" class="icon icon-clickable" (click)="removeCenterFromStudy(studyCenter.id)"/>
							</div>
							<span *ngIf="studyCenterListEmpty()" class="form-validation-alert" i18n="AcqEquip detail|Center required error@@acqEqptDetailCenterRequiredError">No center is currently associated to the research study!</span>
						</span>
					</li>
				</ol>
			</fieldset>
			<div class="footer command-zone">
				<span [ngSwitch]="mode">
					<button i18n="View center|Back button label@@backButton" class="Button" (click)="back()">Back</button>
					<ng-template [ngSwitchCase]="'view'" *ngIf="canModify">
						<button type="submit" i18n="View center|Edit button label@@editButton" (click)="edit()" class="Button">Edit</button>
					</ng-template>
					<ng-template [ngSwitchCase]="'edit'" *ngIf="canModify">
						<button type="submit" i18n="Edit center|Update button label@@updateButton" (click)="update()" class="Button" [disabled]="!studyForm.valid || studyCenterListEmpty()">Update</button>
					</ng-template>
					<ng-template [ngSwitchCase]="'create'" *ngIf="canModify">
						<button type="submit" i18n="Edit center|Create button label@@createButton" (click)="create()" class="Button" [disabled]="!studyForm.valid || studyCenterListEmpty()">Create</button>
					</ng-template>
				</span>
			</div>
		</form>
	</div>
	<div class="layout right" *ngIf="mode=='view' && loading">
		<span class="right-col">
			<div class="study-data" i18n="Study data|Title@@studyDetailDataTitle">Data</div>
		</span>
		<study-tree [study]="study"></study-tree>
	</div>
</div>