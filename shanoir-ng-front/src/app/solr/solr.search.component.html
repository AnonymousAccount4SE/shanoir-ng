<!--
Shanoir NG - Import, manage and share neuroimaging data
Copyright (C) 2009-2019 Inria - https://www.inria.fr/
Contact us on https://project.inria.fr/shanoir/

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

You should have received a copy of the GNU General Public License
along with this program. If not, see https://www.gnu.org/licenses/gpl-3.0.html
-->

<form class="row" [formGroup]="form">
    <div class="left">
        <h2>Solr Search</h2>
        <input type="text" id="searchBar" placeholder="Search..">
        <ol id="facet">
            <li>
                <span class="button" (click)="removeAllFacets(); table.refresh()">
                    <i class="fas fa-ban"></i> Remove all criteria
                </span>
            </li>
            <!-- <li>
                <label>Study Name</label> 
                <span class="right-col">
                    <select-box [(ngModel)]="solrRequest.study" formControlName="study" (change)="onStudyChange($event)" (onAddClick)="onStudyAdd()" [addDisabled]="!selectedStudies.length < maxSelectedStudies">
                        <select-option *ngFor="let study of studies" [value]="study" [disabled]="isStudyAlreadySelected(study.id)">{{study?.name}}</select-option>
                    </select-box>
                    <label *ngIf="hasError('study', ['required'])" [@slideDown]="hasError('study', ['required'])" class="form-validation-alert">Study is required!</label>
                </span>
            </li> -->
            <!-- <li>
                <label>Subject Name</label>
                <span class="right-col">
                    <mat-form-field>
                        <input type="text" matInput [(ngModel)]="solrRequest.subject" formControlName="subject" [matAutocomplete]="auto">
                        <mat-autocomplete #auto="matAutocomplete">
                            <mat-option *ngFor="let option of filteredSubjectNames | async" [value]="option">
                                {{option}}
                            </mat-option>
                        </mat-autocomplete>
                    </mat-form-field>
                    <label *ngIf="hasError('subject', ['required'])" [@slideDown]="hasError('subject', ['required'])" class="form-validation-alert">Subject is required!</label>
                </span>
            </li> -->
            <li>
                <label>Study Name</label>
                <span class="right-col">
                        <span class="button" (click)="showAllStudies(); table.refresh()">
                            &#9664; Show all studies
                        </span>
                    <checkbox-list [(ngModel)]="solrRequest.studyName" formControlName="studyName" [items]="facetResultPage[0]" ></checkbox-list>
                </span>
            </li>
            <li>
                <label>Subject Name</label>
                <span class="right-col">
                    <checkbox-list [(ngModel)]="solrRequest.subjectName" formControlName="subjectName" [items]="facetResultPage[1]" (change)="table.refresh()"></checkbox-list>
                </span>
            </li>
            <li>
                <label>Examination Comment</label>
                <span class="right-col">
                    <checkbox-list [(ngModel)]="solrRequest.examinationComment" formControlName="examinationComment" [items]="facetResultPage[2]" (change)="table.refresh()"></checkbox-list>
                </span>
            </li>
            <li>
                <label>Dataset Name</label> 
                <span class="right-col">
                    <checkbox-list [(ngModel)]="solrRequest.datasetName" formControlName="datasetName" [items]="facetResultPage[3]" (change)="table.refresh()"></checkbox-list>
                </span>
            </li>
            <li>
                <label>Dataset Creation Date</label>
                <br/>
                <label>bewteen </label>
                <span class="right-col">
                    <datepicker [(ngModel)]="solrRequest.datasetStartDate" formControlName="startDate"></datepicker>
                    <label *ngIf="hasError('startDate', ['format'])" class="form-validation-alert">Date should be valid! Date format: dd/mm/yyyy</label>
                </span>
                <br/>
                <label>and </label>
                <span class="right-col">
                    <datepicker [(ngModel)]="solrRequest.datasetEndDate" formControlName="endDate"></datepicker>
                    <label *ngIf="hasError('endDate', ['format'])" class="form-validation-alert">Date should be valid! Date format: dd/mm/yyyy</label>
                    <label *ngIf="hasError('endDate', ['order'])" class="form-validation-alert">End date must be subsequent to start date</label>
                </span>
            </li>
            <li>
                <label>Dateset ModalityType</label>
                <span class="right-col">
                    <checkbox-list [(ngModel)]="solrRequest.datasetType" formControlName="datasetTypes" [items]="facetResultPage[4]" (change)="table.refresh()"></checkbox-list>
                </span>
            </li>
            <li>
                <label>Mr Dateset Nature</label>
                <span class="right-col">
                    <checkbox-list [(ngModel)]="solrRequest.datasetNature" formControlName="datasetNatures" [items]="facetResultPage[5]" (change)="table.refresh()"></checkbox-list>
                </span>
            </li>
            <!-- criteres choisis -->
            <button class="Button" (click)="table.refresh()" [disabled]="!form.valid">Search</button>
        </ol>
    </div>
    <div class="right">
        <h2>Results</h2>
        <shanoir-table #table
            [getPage]="getPage.bind(this)" 
            [columnDefs]="columnDefs" 
            (rowClick)="onRowClick($event)"
            [browserSearch]="false"
            [selectionAllowed]="true">
        </shanoir-table>
    </div>
</form>